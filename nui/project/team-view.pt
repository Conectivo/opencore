<html metal:use-macro="here/@@standard_macros/master">
  <body>

    <div metal:fill-slot="content">              

      <div id="oc-content-main">

          <h1>Team members</h1>

          <!-- batch needs to have some variables set up to work properly.
          here is where they are defined -->
          <tal:got_results condition="view/memberships"
                           define="batch view/memberships;
                                   batch_base_url request/ACTUAL_URL;
                                   start batch/start | nothing;
                                   end batch/end | nothing;
                                   sequence_length batch/sequence_length | nothing;
            ">

            <!-- display the number of results that came back -->
            <div class="oc-searchresults-nresults" tal:define="many python: start!=end">
              
              <!-- pagination uses the batch macro -->
              <div metal:use-macro="context/@@nui_batch_macros/pagination"/>
              
              Member<tal:plural condition="many">s</tal:plural> <span tal:replace="start">1</span>
              <tal:justone condition="many">&ndash; <span tal:replace="end">10</span></tal:justone> 
              of <span tal:replace="sequence_length">376</span> sorted by

              <!-- when sorting, we post the action to distinguish between searching
              this was necessary because the batch macro reposts the request data, and we see problems when trying to reset to page when the sorting changes -->
              <form name="people_sort" method="POST" action="." tal:attributes="action string:${context/absolute_url}/team">
              <!-- FIXME This should not require a button to work. -->
                <select name="sort_by" tal:define="sorted_by python: request.get('sort_by')">
                  <option value="relevancy" tal:attributes="selected python: sorted_by == 'relevancy'">relevancy</option>
                  <option value="getId" tal:attributes="selected python: sorted_by == 'getId'">username</option>
                  <option value="exact_getFullname" tal:attributes="selected python: sorted_by == 'exact_getFullname'">real name</option>
                </select>
              </form>
            </div>

          <!-- the results are displayed here -->
          <ol class="oc-roster oc-clearAfter">
            <li class="oc-clearAfter oc-boxy vcard" tal:repeat="membrain view/memberships">
              <tal:member-result define="membership membrain/getObject; mem membership/getMember">
                <div class="oc-avatar" tal:define="imgdata mem/getPortrait">
                  <a href="" tal:omit-tag="python: view.no_home(mem.getId())" tal:attributes="href string:${context/portal_url}/people/${mem/getId}">
                    <img tal:condition="imgdata" tal:replace="structure python: view.add_class_to_img(imgdata, 'photo')" />
                    <img tal:condition="not: imgdata" class="photo" tal:attributes="src string:defaultUser.gif" />
                  </a>
                </div>
                <div class="oc-roster-content">
                  <h3 class="fn">
                    <a href="" tal:omit-tag="python: view.no_home(mem.getId())"
                       tal:attributes="href string:${context/portal_url}/people/${mem/getId}"
                       tal:content="mem/getId"
                       />
                  </h3>
                  <span class="oc-discreetText adr" tal:define="loc mem/getLocation" tal:condition="loc" tal:content="loc"> Big City, ST</span>
                  <div class="oc-discreetText">XXX contributions since
                    <span tal:replace="python: view.pretty_date(membrain.CreationDate)">January 1, 2000</span>,
                    latest <span tal:replace="python: view.pretty_date(membrain.ModificationDate)">45 years ago</span>
                  </div>
                  <div tal:define="projects python: view.projects_for_member(mem);
                                   nprojects python: len(projects);
                                   plural python: nprojects > 1;
                                   view_all python: view.more_than_ten_projects(mem)"
                                   >
                    <span class="oc-roster-projects">
                      Project<span tal:condition="plural">s</span> (<span tal:replace="nprojects">N</span>):
                    </span>
                    <ul class="oc-inlineList">
                      <li tal:repeat="project projects">
                        <!-- isprivate setting -->
                        <a href="" tal:attributes="href project/absolute_url" tal:define="isprivate nothing">
                          <span tal:replace="project/Title" />
                          <span tal:condition="isprivate" class="oc-discreetText">(private)</span>
                          <a href=""
                             tal:attributes="href string:${view/get_portal/absolute_url}/people/${mem/getId}"
                             tal:condition="view_all"
                             tal:content="string:(view all)"
                             />
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </tal:member-result>
            </li>
          </ol>
          <div class="oc-searchresults-nresults" tal:define="many python: start!=end">
          
            <!-- we put pagination on the bottom of the page too -->
            <div metal:use-macro="context/@@nui_batch_macros/pagination"/>
          
            Member<tal:plural condition="many">s</tal:plural> <span tal:replace="start">1</span>
            <tal:justone condition="many">&ndash; <span tal:replace="end">10</span></tal:justone> 
            of <span tal:replace="sequence_length">376</span> 

    </div>
        </tal:got_results>

        <!-- if we get no results, this is what is displayed -->
        <div tal:condition="not: view/memberships">No results found.</div>

    </div> <!-- content-main -->


    <div id="oc-content-sidebar">
    </div><!-- content-sidebar -->
    
  </div><!-- content-fill-slot -->
</body>
</html>
