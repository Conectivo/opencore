<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" i18n:domain="plone"
  metal:use-macro="here/@@standard_macros/master">
  <body>
    <div metal:fill-slot="content">
      <div metal:use-macro="here/@@listen_macros/bcrumb"/>
      <div metal:use-macro="here/@@listen_macros/tabs"/>
      <div id="oc-content-main" i18n:domain="listen"
        tal:define="is_post_moderated view/is_post_moderated;
                    is_membership_moderated view/is_membership_moderated;
                    pending_list view/get_pending_lists">
        <div class="oc-headingBlock">
          <h2 i18n:translate="" tal:content="view/Title" />
        </div>

        <h3 i18n:translate="">Posts awaiting moderation</h3>
        <form name="moderate-post-form" id="moderate-post-form"
            tal:attributes="action request/ACTUAL_URL"
            tal:define="errors view/errors|nothing"
            tal:repeat="post pending_list">
          <table class="oc-dataTable" cellspacing="0" tal:condition="pending_list">
            <thead>
            <tr>
              <th scope="col" i18n:translate="" >From</th>
              <th scope="col" i18n:translate="" >Message</th>
              <th scope="col" ></th>
            </tr>
            </thead>
            <tbody>
              <tr>
                <td tal:content="post/user_name" /> 
                <td>
                  <h4 tal:content="post/subject" />
                  <p tal:content="python: post['body'][:50]" colspan="3" />
                </td>
                <td>
                <ul class="oc-actions oc-dataTable-row-actions">
                  <li>
                    <input type="hidden" name="postid" tal:attributes="value python: str(post['postid'])" />
                    <input type="hidden" name="email" tal:attributes="value python: str(post['user'])" />
                  </li>
                  <li>
                    <input type="submit" name="post_approve" i18n:attributes="value" value="Approve" /> 
                  </li>
                  <li>
                    <input type="submit" name="post_discard" i18n:attributes="value" value="Discard" />
                  </li>
                  <li>
                    <input tal:condition="python:is_post_moderated or is_membership_moderated" type="submit" name="post_reject" i18n:attributes="value" value="Reject" />
                  </li>
                  <li>
                    <input tal:condition="python:is_post_moderated or is_membership_moderated" name="reject_reason" type="text" />
                  </li>
                </ul>
                </td>
              </tr>
            </tbody>
          </table>
        </form>

        <p tal:condition="python: not pending_list">No posts pending moderation</p>

        <tal:members condition="is_membership_moderated"
          tal:define="pending_members view/get_pending_members">
          <h3 i18n:translate="">Users awaiting moderation</h3>
          <table tal:condition="pending_members">
            <tr>
              <th i18n:translate="">User</th>
              <th></th>
            </tr>

            <form name="moderate-member-form" id="moderate-member-form"
              tal:attributes="action request/ACTUAL_URL"
              tal:define="errors view/errors|nothing"
              tal:repeat="pending_member pending_members">
              <tr>
                <td tal:content="pending_member/user_name" style="text-align:center" />
                <td>
                  <input type="hidden" name="email" tal:attributes="value pending_member/user" />
                  <input i18n:attributes="value" type="submit" name="member_approve" value="approve" />
                  <input i18n:attributes="value" type="submit" name="member_discard" value="discard" />
                  <input i18n:attributes="value" type="submit" name="member_reject" value="reject" />
                  <input type="text" name="reject_reason" />
                </td>
              </tr>
            </form>
          </table>
          <p tal:condition="python: not pending_members ">No members pending moderation.</p>
        </tal:members>

        <p tal:content="view/errors|nothing" />
      </div>
    </div>
  </body>
</html>
