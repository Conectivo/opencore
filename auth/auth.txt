Test for Cookie Auth
====================

  >>> import sha
  >>> import base64
  >>> from urllib import quote
  >>> from zope.interface import implementedBy
  >>> from Interface.Implements import flattenInterfaces
  >>> from Products.PloneTestCase.PloneTestCase import portal_name

Make sure cookie plugin is installed and activated.

  >>> uf = self.portal.acl_users

  >>> uf.objectIds('Signed Cookie Auth Helper')
  ['credentials_signed_cookie_auth']

  >>> plugins = uf.plugins
  >>> cookie = uf['credentials_signed_cookie_auth']

Create a user

  >>> user_name, user_password, user_role = ('baz', 'bar', 'Manager')
  >>> uf.userFolderAddUser(user_name, user_password, [user_role], [])

  >>> uf.getUserById(user_name)
  <MembraneUser 'baz'>

Login to Plone site using Signed Cookie Auth should work too.

  >>> cookie = uf['credentials_signed_cookie_auth']

  >>> auth = sha.new(user_name + user_password + cookie.secret).hexdigest()
  >>> encoded = base64.encodestring('%s:%s:%s' % (user_name, user_password, auth))
  >>> print base64.encodestring('%s:%s:%s' % (user_name, user_password, auth))
  YmF6OmJhcjoxYmE3YjVjZGY2NmExNGUwMjkxYzUwZjRlYWEyY2Q2NWU1NzlkY2Qx
  ...

The cookie set by PlonePAS should be URL-quoted.

  >>> print http(r"""
  ... GET /%s/logged_in HTTP/1.1
  ... Cookie: __ac=%s
  ... """ % (portal_name, quote(encoded)), handle_errors=False)
  HTTP/1.1 200 OK
  ...
  Set-Cookie: __ac="OjplNWU5ZmExYmEzMWVjZDFhZTg0Zjc1Y2FhYTQ3NGYzYTY2M2YwNWY0"; Path=/...

