<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

  <body>

    <div metal:fill-slot="main">
    <metal:main-macro define-macro="main">

    	<tal:block define="userinfo view/getUserInfo;
                       portal_types portal/portal_types;">

	<div id="content-title">
		<h1 class="documentFirstHeading" tal:content="string: ${userinfo/login}'s Profile" />
	</div>

      <div id="content-main">
	
      <!-- page left container -->
      <div id="op-main">

        <!-- portrait + info -->
        <div id="op-member-info">
		
		<!-- view/edit tabs -->
		
		<div id="op-member-details-wrapper" class="clear-after">

          <!-- portrait -->
          <div style="float: left; padding-right: 10px;">
            <!-- if they have a portrait -->
            <img id="op-member-portrait" tal:condition="userinfo/portrait" tal:attributes="src userinfo/portraiturl"/>
            <!-- if they don't have a portrait -->
            <!-- but they can add one -->
            <span tal:condition="python: not userinfo['portrait'] and userinfo['editpermission']">
              <a tal:attributes="href userinfo/prefsurl">
                <img id="op-member-noportrait-edit" tal:attributes="src string:defaultUser-edit.gif">
              </a>
            </span>
            <!-- can't add one -->
            <span tal:condition="python: not userinfo['portrait'] and not userinfo['editpermission']">
              <img id="op-member-noportrait" tal:attributes="src string:defaultUser.gif">
            </span>
          </div> <!-- end portrait -->

          <!-- details -->
          <dl id="op-member-details">
			<dt>Name</dt>
            <dd><a href="" tal:attributes="href string:${portal_url}/author/${userinfo/login}"><span tal:condition="userinfo/fullname" tal:content="userinfo/fullname"></span></a></dd>
            <dt>Location</dt>
            <dd tal:condition="userinfo/location" tal:content="userinfo/location"></dd>
			<dt>Projects</dt>
			<dd id="op-member-details-projects"><!-- projects listing -->
				<div tal:condition="userinfo/projects">
	              <ul>
	                <tal:repeat repeat="proj userinfo/projects">
	                  <li>
	                    <a href="" tal:attributes="href proj/absolute_url"><span tal:replace="python: proj.getFull_name() or proj.getId()" /></a>
	                  </li>
	                </tal:repeat>
	              </ul>
	            </div>
			</dd><!-- end projects listing -->
            </dl><!-- end details -->
        </div>
        </div> <!-- end portrait + info -->

        <!-- wiki -->
        <div id="op-member-wiki">

          <!-- edit link --><!-- REDO as standard view and edit tabs -->
          <div style="border-top: thin solid gray; margin-bottom: 10px">
            <div tal:condition="userinfo/editpermission" style="text-align: right">
              <a href="edit">edit</a>
            </div>
          </div> <!-- end edit link -->

          <div tal:content="structure userinfo/wiki" />

        </div> <!-- end of wiki -->

      </div> <!-- end page left container -->


      
      <!-- TODO only show "pages" and "projects" -->
      <div class="op-sbar"><!-- sidebar -->
		<div id="op-member-activity"><!-- latest content -->
        <tal:authorContent define="author_content python:view.getLatestContent();"
                           condition="author_content">

          <div metal:define-macro="user_content_listing" >

          <h2 i18n:translate="heading_author_content">
            Recent activity
          </h2>

            <table class="listing smallText" summary="List of content written by an author grouped by content type" 
                   i18n:attributes="summary summary_author_content_list;">
              <tal:repeat repeat="content_by_type author_content">
                <tal:grouping define="getTypeInfo nocall:portal_types/getTypeInfo;
                                      content_type_ content_by_type/portal_type;
                                      type_title python: getTypeInfo(content_type_) or None"
                              condition="type_title">
                  <tr>
                    <th scope="col"
                        i18n:translate=""
                        tal:define="getTypeInfo nocall:portal_types/getTypeInfo;
                                    content_type_ content_by_type/portal_type;
                                    type_title python: getTypeInfo(content_type_) or None"
                        tal:content="python:type_title and type_title.Title() or content_type_ + ' is not available'">
                      Type
                    </th>

					<th scope="col">Date</th>
					
                  </tr>
                  <tal:repeat repeat="item content_by_type/content_items">
                    <tr>
                      <td>
                        <a href="" tal:attributes="href item/getURL"
                           tal:content="item/pretty_title_or_id">title</a>
                      </td>
                      <td tal:content="python:here.toLocalizedTime(item.Date)">
                        Date
                      </td>
                    </tr>
                  </tal:repeat>
                </tal:grouping>
              </tal:repeat>
            </table>
          </div>

          <div>
            <a href=""
               tal:attributes="href string:$here_url/search?Creator=${userinfo/login}&amp;sort_on=Date&amp;sort_order=reverse"
               i18n:translate="go_to_search_author_content">All content...</a>
          </div>

        </tal:authorContent>
      </div> <!-- end latest content -->
	</div> <!-- end sidebar -->
      </div>
    </tal:block>

    </metal:main-macro>
    </div> <!-- main metal fill slot -->

  </body>
</html>
