<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

  <body>

    <div metal:fill-slot="main">
    <metal:main-macro define-macro="main">

        <tal:block define="userinfo view/getUserInfo;
                       portal_types portal/portal_types;">

    <div id="content-title">
        <h1 class="documentFirstHeading" tal:content="python: (userinfo['fullname'] or userinfo['login']) + '\'s Profile'" />
	    <div id="op-member-dates" class="smallText">
	        <span tal:replace="userinfo/login" /> has been a member since <span tal:replace="userinfo/membersince" />
	        and was last online at <span tal:replace="userinfo/lastlogin" />
	    </div>
    </div>

      <div id="content-main">
    
      <!-- page left container -->
      <div id="op-main">

        <!-- portrait + info -->
        <div id="op-member-info">

            <ul tal:condition="userinfo/editpermission" class="contentViews">
                <li class="contentview-view selected"><a>View</a></li>
                <li class="contentview-edit"><a tal:attributes="href userinfo/prefsurl">Edit</a></li>
            </ul>
        
        <div id="op-member-details-wrapper" class="clear-after">

          <!-- portrait -->
            <div id="op-member-portrait">
            <!-- if they have a portrait -->
            <img tal:condition="userinfo/portrait" tal:attributes="src userinfo/portraiturl" alt="" />
            <!-- if they don't have a portrait -->
            <!-- but they can add one -->
            <span tal:condition="python: not userinfo['portrait'] and userinfo['editpermission']"
              ><a tal:attributes="href userinfo/prefsurl"
                ><img id="op-member-noportrait-edit" tal:attributes="src string:defaultUser-edit.gif" alt="add an image"
              /></a>
            </span>
            <!-- can't add one -->
            <span tal:condition="python: not userinfo['portrait'] and not userinfo['editpermission']">
              <img id="op-member-noportrait" tal:attributes="src string:defaultUser.gif" alt=""/>
            </span>
            </div>
          <!-- end portrait -->

          <!-- details -->
          <dl id="op-member-details">
            <dt>Name</dt>
            <dd tal:condition="userinfo/fullname"><span tal:condition="userinfo/fullname"
                tal:replace="python: userinfo['fullname'] + ' '" />(<span tal:replace="userinfo/login" />)</dd>
            <dd tal:condition="python: not userinfo['fullname'] and userinfo['editpermission']"
                tal:content="structure string:<a href='${userinfo/prefsurl}'>add your name</a>" />
            <dd class="missingText" tal:condition="python: not userinfo['fullname'] and not userinfo['editpermission']"
                >(<span tal:content="userinfo/login"></span>)</dd>
<!--
                <span tal:condition="userinfo/fullname" tal:content="python: userinfo['fullname'] + ' '" />(<a href="" tal:attributes="href string:${portal_url}/author/${userinfo/login}"><span tal:content="userinfo/login"></span></a>)</dd>
-->
            <dt tal:condition="python: userinfo['location'] or userinfo['editpermission']">Location</dt>
            <dd tal:condition="userinfo/location" tal:content="userinfo/location" />
            <dd tal:condition="python: not userinfo['location'] and userinfo['editpermission']" tal:content="structure
                string:<a href='${userinfo/prefsurl}'>add your location</a>"/>
            <dt>Projects (<span tal:replace="python:len(userinfo['projects'])" />)</dt>
            <dd><!-- projects listing -->
                  <ul id="op-member-details-projects" tal:condition="userinfo/projects">
                    <tal:repeat repeat="proj userinfo/projects">
                      <li><a href="" tal:attributes="href proj/absolute_url"
                          ><span tal:replace="python: proj.getFull_name() or proj.getId()" /></a>
                      </li>
                    </tal:repeat>
                  </ul>
                <span class="missingText" tal:condition="python: not userinfo['projects']">
                   <span tal:condition="userinfo/isme" tal:replace="string:you do" /><span tal:condition="not: userinfo/isme"
                       tal:replace="python: (userinfo['login']) + ' does '" /> not belong to any projects
                </span>
            </dd><!-- end projects listing -->
            </dl><!-- end details -->
        </div>
        </div> <!-- end portrait + info -->

        <!-- wiki -->
        <div id="op-member-wiki">

          <!-- edit link --><!-- REDO as standard view and edit tabs -->
            <ul tal:condition="userinfo/editpermission" class="contentViews">
              <li class="contentview-view selected"><a>View</a></li>
              <li class="contentview-edit"><a href="edit">Edit</a></li>
            </ul>
          <!-- end edit link -->

          <div tal:content="structure userinfo/wiki" />

        </div> <!-- end of wiki -->

      </div> <!-- end page left container -->


      
      <div class="op-sbar"><!-- sidebar -->
        <div id="op-member-activity"><!-- latest content -->
        <tal:authorContent define="author_content python:view.getLatestContent();"
                           condition="author_content">

          <div metal:define-macro="user_content_listing" >

          <h2 class="documentFirstHeading" i18n:translate="heading_author_content">
            Recent activity
          </h2>

            <table class="listing smallText" summary="List of content written by an author grouped by content type" 
                   i18n:attributes="summary summary_author_content_list;">
              <tal:repeat repeat="content_by_type author_content">
                <tal:grouping define="getTypeInfo nocall:portal_types/getTypeInfo;
                                      content_type_ content_by_type/portal_type;
                                      type_title python: getTypeInfo(content_type_) or None"
                              condition="type_title">
                  <tr>
                    <th scope="col"
                        i18n:translate=""
                        tal:define="getTypeInfo nocall:portal_types/getTypeInfo;
                                    content_type_ content_by_type/portal_type;
                                    type_title python: getTypeInfo(content_type_) or None"
                        tal:content="python:type_title and type_title.Title() or content_type_ + ' is not available'">
                      Type
                    </th>

                    <th scope="col">Date</th>
                    
                  </tr>
                  <tal:repeat repeat="item content_by_type/content_items">
                    <tr>
                      <td>
                        <a href="" tal:attributes="href item/getURL"
                           tal:content="item/pretty_title_or_id">title</a>
                      </td>
                      <td tal:content="python:here.toLocalizedTime(item.Date)">
                        Date
                      </td>
                    </tr>
                  </tal:repeat>
                </tal:grouping>
              </tal:repeat>
                <tr>
                    <th scope="row"><a href=""
                       tal:attributes="href string:$here_url/search?Creator=${userinfo/login}&amp;sort_on=Date&amp;sort_order=reverse"
                       i18n:translate="go_to_search_author_content">All content...</a></th>
            </table>

          </div>


        </tal:authorContent>
      </div> <!-- end latest content -->
    </div> <!-- end sidebar -->
      </div>
    </tal:block>

    </metal:main-macro>
    </div> <!-- main metal fill slot -->

  </body>
</html>
