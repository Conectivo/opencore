<tal:vars tal:define="global usr view/user;
                      global canedit usr/canedit;
                      global page view/page" />

<html metal:use-macro="here/@@standard_macros/master">
  <head>
    <metal:do metal:fill-slot="link" >
                    
                    
                        <style type="text/css"><!-- @import url(http://www.openplans.org/portal_css/Plone%20Default/ploneStyles3308.css); --></style>
                    
                    
                
            
            
                
                    
                    
                        <style type="text/css"
    media="screen"><!-- @import url(http://www.openplans.org/portal_css/Plone%20Default/ploneStyles6765.css); --></style>
                    
            
            
                
                    
                    
                        <style type="text/css"><!-- @import url(http://www.openplans.org/portal_css/Plone%20Default/ploneStyles9116.css); --></style>

                    
            
            
                
                    
                    
                        <style type="text/css"><!-- @import url(http://www.openplans.org/portal_css/Plone%20Default/ploneStyles0440.css); --></style>
                    
                    
                
            
            
                
                    
                    
                        <style type="text/css"><!-- @import url(http://www.openplans.org/portal_css/Plone%20Default/ploneStyles2216.css); --></style>
                    
                    
                
            
            
                
                    
                    
                        <style type="text/css"><!-- @import url(http://www.openplans.org/portal_css/Plone%20Default/ploneStyles1915.css); --></style>
                    
                    
</metal:do>
    <metal:do metal:fill-slot="script" >


            
                <script type="text/javascript"
                        src="http://www.openplans.org/portal_javascripts/Plone%20Default/ploneScripts3780.js">
                </script>
                
            
            
                <script type="text/javascript"
                        src="http://www.openplans.org/portal_javascripts/Plone%20Default/ploneScripts3071.js">
                </script>
                
            
            
                <script type="text/javascript"
                        src="http://www.openplans.org/portal_javascripts/Plone%20Default/ploneScripts2343.js">
                </script>
                
            
            
                <script type="text/javascript"
                        src="http://www.openplans.org/portal_javascripts/Plone%20Default/ploneScripts6045.js">
                </script>
                
            
            
                <script type="text/javascript"
                        src="http://www.openplans.org/portal_javascripts/Plone%20Default/ploneScripts5277.js">
                </script>

                
            
            
                <script type="text/javascript"
                        src="http://www.openplans.org/portal_javascripts/Plone%20Default/kupuploneeditor.js">
                </script>
                
            
            
                <script type="text/javascript"
                        src="http://www.openplans.org/portal_javascripts/Plone%20Default/ploneScripts9249.js">
                </script>
</metal:do>
  </head>
  <body>
    <div metal:fill-slot="content">

<div id="content-title">
  <!-- title -->
  <span id="content-title-pagetitle">
    <a tal:attributes="href string:${view/pageURL}/@@magic?oc-content=oc-project-view"
       tal:content="view/pagetitle" />
  </span>

  <!-- tabs -->
  <ul class="oc-tabs">
    <li class="deselected">
      <a tal:attributes="href string:${view/pageURL}/@@magic?oc-content=oc-project-view">view</a>
    </li>
    <li class="selected">
      <a tal:attributes="href string:${view/pageURL}/@@magic?oc-content=oc-project-edit">edit</a>
    </li>
    <li class="deselected">
      <a tal:attributes="href string:${view/pageURL}/@@magic?oc-content=oc-project-history">history</a>
    </li>
  </ul>
</div>

<!-- TODO -->
<div id="content-main">
  project-edit template
  <div tal:condition="python:view.canEdit()">
 
<!-- Kupu: defines. TODO: move (some of) these up to main template -->
  <tal:block define="Iterator python:modules['Products.CMFPlone'].IndexIterator;
		     lockable python:hasattr(here, 'wl_isLocked');
		     errors python: options.get('errors', {});
		     isLocked python:lockable and here.wl_isLocked();
		     member python:here.portal_membership.getAuthenticatedMember();
		     portal python:context.portal_url.getPortalObject();
		     portal_url here/portal_url;
		     tabindex python:Iterator(pos=7000);
">

     <form name="edit_form"
            method="post"
            enctype="multipart/form-data"
            class="enableUnloadProtection"
            action=""
            tal:attributes="action python:here.absolute_url()  + '/@@project-edit'">

<input type="hidden" name="submitted" value="1" />

  <metal:fieldMacro use-macro="python:here.widget('text', mode='edit')"/>

<!--attachments -->

<tal:block define="attachments python:here.getFolderContents(contentFilter = {'portal_type' : ['FileAttachment']})">
	<dl id="attachment-controls" class="collapsible inline collapsedOnLoad">
        <dt class="collapsibleHeader">Manage Attachments</dt>
        <dd class="collapsibleContent">

    <div tal:condition="nocall:attachments">

	<table>
	<tal:repeat repeat="attachment attachments">
		
	<tr>
		<td valign="top">	
			<input
				type="checkbox"
				class="noborder"
				name="attachmentIds:list"
				id="#"
				value="#" 
				tal:attributes="value attachment/getId;"
				/>
		</td>
		<td valign="top" align="center" style="padding: 2px">
		    <a href="" target="_blank" tal:attributes="href attachment/getURL">
                <img tal:replace="structure here/file_icon.gif"/>
            </a>
		</td>
		<td valign="middle" style="margin-left: 2em">
			<input 
				type="hidden" 
				name="attachmentTitles.id:records" 
				tal:attributes="value attachment/getId" />
			<input
				style="margin-left: 2px"
				type="text"
				name="attachmentTitles.title:records" 
				size="30" 
				tabindex=""
				id="#"
				value="#"
				tal:attributes="tabindex tabindex/next;
								value attachment/Title;"/>
			<div class="discreet">
    			(<a href="" target="_blank" tal:attributes="href attachment/getURL"
    				tal:content="attachment/getId">Id</a> -  
    			 <span tal:replace="attachment/getObjSize"/>)
			 </div>
		</td>
	</tr>
	</tal:repeat>
	</table>

    <div class="formControls" tal:condition="nocall:attachments">
        <input class="context"
               type="submit"
               name="form.button.RenameAttachments"
               value="Change titles"
               i18n:attributes="value" 
               tal:attributes="tabindex tabindex/next;"/>
        <input class="context"
               type="submit"
               name="form.button.MoveAttachments"
               value="Move first"
               i18n:attributes="value" 
               tal:attributes="tabindex tabindex/next;"/>
        <input class="destructive"
               type="submit"
               name="form.button.DeleteAttachments"
               value="Delete selected"
               i18n:attributes="value"
               tal:attributes="tabindex tabindex/next;"/>
    </div>
    
    </div>
    
    <div class="bottomDivider">&nbsp;</div>

	<div class="field"
			tal:define="error_title errors/attachmentTitle|nothing;"
	        tal:attributes="class python: error_title and 'field error' or 'field'">
		  
		  <label for="title">
		  	Add attachment to document
		  </label>
		  <div class="formHelp">
				Enter a title for the attachment
		  </div>
		  <div tal:content="error_title">Validation error output</div>
		  <input type="string" 
				 name="attachmentTitle" 
				 size="30" 
				 tabindex=""
				 tal:attributes="tabindex tabindex/next;"
				 value=""/>
				 
	</div>    
   <div 
	 class="field "
	 tal:define="error_file errors/attachmentFile|nothing;"
	 tal:attributes="class python: error_file and 'field error' or 'field'"> 
		<div class="formHelp">
			Select an attachment to add and click 'Upload'
		</div>
		
		<div tal:content="error_file">Validation error output</div>

		<input 				   
			type="file" 
			name="attachmentFile"
			size="30" 
			tabindex="" 
			tal:attributes="tabindex tabindex/next;
							value request/attachmentFile/filename | nothing"
		/>
	</div>
		  
	  
	<div class="formControls"> 
		<input class="context"
			   tabindex=""
			   type="submit" 
			   name="form.button.UploadAttachment" 
			   value="Upload" 
			   i18n:attributes="value"
			   tal:attributes="tabindex tabindex/next;" /> 
			<div class="formHelp">
			  Once an attachment is uploaded, you can link to it in your body
			  text by putting double parentheses around either the ((title))
                          or the ((filename)).
		        </div>
	 </div>

    </dd>
    </dl>

  </tal:block>

<!-- end attachments -->

  <input class="context"
         tabindex=""
         type="submit"
         name="form_submit"
         value="Save"
         i18n:attributes="value label_save;"
         tal:attributes="tabindex tabindex/next;
                         disabled python:isLocked and 'disabled' or None;"
	 />
  <input class="standalone"
         tabindex=""
         type="submit"
         name="form.button.cancel"
         value="Cancel"
         i18n:attributes="value label_cancel;"
         tal:attributes="tabindex tabindex/next"
         />

  </form>

  </tal:block>

  </div>
  <div tal:condition="python:not view.canEdit()">
    you do not have sufficient privileges to edit this page
  </div>
</div>

    </div><!-- end content slot -->
  </body>
</html>
