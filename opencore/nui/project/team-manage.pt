<tal:vars define="global proj view/project_info;
                  global team_manage_macros view/team_manage_macros/macros" />

<tal:handle-request condition="request/handle_request | nothing">
  <tal:callit define="bogus view/handle_request" />
</tal:handle-request>

<html metal:use-macro="here/@@standard_macros/master">
  <body>
    <div metal:fill-slot="content">
      <div class="oc-headingBlock">
        <h1>Team Management</h1>
        <p class="oc-headingContext"
           tal:define="nmembers python:len(view.active_mships);
                       npending python:len(view.pending_mships)"
           tal:content="string:$nmembers members, $npending pending memberships" />
      </div>

      <div id="oc-security-settings" class="oc-security-settings">
        <h2>Your security settings</h2>
        <p>
          Currently only your project members can view the content
          of your project.  Only administrators can add new features
          to the site.
        </p>
        <p><a href="preferences">Change security settings</a></p>
      </div>

      <div id="oc-content-main" class="oc-content-main-fullWidth">
        
        <tal:pendingrequests
           define="item_heading string:Users requesting to join your project;
                   item_type string:request;
		   item_collection view/pending_requests;
                   num_items python:len(item_collection);"
           condition="item_collection">
	  <metal:pending
             use-macro="team_manage_macros/pendinglist" />
	</tal:pendingrequests>

        <tal:pendinginvitations
           define="item_heading string:Pending membership invitations;
                   item_type string:invitation;
		   item_collection view/pending_invitations;
                   num_items python:len(item_collection);"
           condition="item_collection">
	  <metal:pending
             use-macro="team_manage_macros/pendinglist" />
        </tal:pendinginvitations>

        <tal:memberships>
          <metal:mshiplist use-macro="team_manage_macros/mshiplist" />
        </tal:memberships>

        <div style="float:right"
             class="oc-rightside">
          <h2>Add new members</h2>
          <hr />
          <h3>Search for members</h3>
          <p class="oc-discreet">Search and invite existing members</p>

          <form name="search-members" id="search-members"
                tal:attributes="action view/request/ACTUAL_URL">
            <input type="hidden" name="handle_request:boolean"
                   value="True" />
            <input class="oc-input-typeText" type="text" name="search_for" />
            <button type="submit" name="search-members" value="search-members"
                    class="oc-button">search</button>
            <div tal:condition="view/results | nothing">
              <div tal:repeat="member view/results">
                [add]
                <tal:mem_url define="mem_url python:view.membertool.getHomeUrl(member.getId)">
                  <a tal:condition="mem_url" tal:attributes="href mem_url"
                     tal:content="string: ${member/getId}: ${member/getFullname}" />
                  <span tal:condition="not:mem_url"
                        tal:replace="string: ${member/getId}: ${member/getFullname}" />
                </tal:mem_url>
              </div>
            </div>
          </form>

          <hr />
        </div>

      </div><!-- end .oc-content-main -->
    </div><!-- end content-fill-slot -->
  </body>
</html>
