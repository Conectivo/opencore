<tal:vars
   define="global team_manage_macros view/team_manage_macros/macros" />


<!-- SHARED SNIPPETS -->

<metal:memberlink define-macro="memberlink">
  <div class="oc-liveItem-value"
       tal:define="mem_id item/getId;
                   mem_url python:view.getMemberURL(mem_id)">
    <a tal:attributes="href mem_url"
       tal:condition="mem_url"
       tal:content="mem_id" />

    <tal:memid condition="not: mem_url"
               replace="mem_id" />
  </div>
</metal:memberlink>

<!-- "PENDING" LISTS (MEMBERSHIP REQUESTS AND INVITATIONS) -->

<metal:pendingrow define-macro="pendingrow">
  <tr class="oc-liveItem" tal:attributes="id item/id">

    <td>
      <input type="checkbox" name="batch[]"
             tal:attributes="value item/id" />
    </td>

    <td>
      <div metal:use-macro="team_manage_macros/memberlink" />
    </td>

    <td metal:define-slot="status" />

    <td metal:define-slot="requesteddate" />

  </tr>
</metal:pendingrow>


<metal:pendingrequest
   define-macro="pendingrequest">
  <tr metal:use-macro="team_manage_macros/pendingrow">

    <td metal:fill-slot="status"
        tal:content="string:needs approval" />

    <td metal:fill-slot="requesteddate"
        tal:define="creationdate item/CreationDate"
        tal:content="python:view.pretty_date(creationdate)" />

  </tr> <!-- end pendingrow -->

</metal:pendingrequest>


<metal:pendinginvitation
   define-macro="pendinginvitation">
  <tr metal:use-macro="team_manage_macros/pendingrow">

    <td metal:fill-slot="status"
        tal:content="string:needs approval" />

    <td metal:fill-slot="requesteddate"
        tal:define="creationdate item/CreationDate"
        tal:content="python:view.pretty_date(creationdate)" />

  </tr> <!-- end pendingrow -->

</metal:pendinginvitation>


<metal:requestbuttons
   define-macro="requestbuttons">

  <li>
    <button type="submit" name="task" value="approve"
            class="oc-button" >approve</button>
  </li>
  <li>
    <button type="submit" name="task" value="discard"
            class="oc-button" >discard</button>
  </li>
  <li>
    <button type="submit" name="task" value="reject"
            class="oc-button" >reject</button>
  </li>
  <li>
    <button type="submit" name="task" value="reject_msg"
            class="oc-button" >reject with message</button>
  </li>

</metal:requestbuttons>


<metal:invitationbuttons
   define-macro="invitationbuttons">

  <li>
    <button type="submit" name="task" value="remove"
            class="oc-button" >remove</button>
  </li>
  <li>
    <button type="submit" name="task" value="send_reminder"
            class="oc-button" >send reminder</button>
  </li>

</metal:invitationbuttons>


<metal:pendinglist define-macro="pendinglist">
  <div class="oc-widget oc-widget-dataTable">

    <div class="oc-heading">
      <h3 tal:content="string:$item_heading ($num_items)" />
    </div>

    <div class="oc-searchresults-nresults">
      1-20 of 55
    </div>
    
    <form class="oc-liveForm" action="modify-contents">
      <input type="hidden" name="item_type"
	     tal:attributes="value item_type" />
      <table class="oc-dataTable" cellpadding="0" cellspacing="0">

        <thead>
          <tr>
            <th class="oc-dataTable-checkBoxColumn"><input type="checkbox" class="oc-checkAll" /></th>
            <th scope="col"><a class="oc-columnSortable oc-selected" href="">Username &darr;</a></th>
            <th scope="col"><a class="oc-columnSortable" href="">Status</a></th>
            <th scope="col"><a class="oc-columnSortable" href="">Date requested</a></th>
          </tr>
        </thead>

	<tbody>

          <tal:items repeat="item item_collection">
            <tr metal:use-macro="python:team_manage_macros.get('pending%s' % item_type)" />
          </tal:items>

	</tbody>

      </table>

      <ul class="oc-actions oc-dataTable-actions">
        <metal:buttons use-macro="python:team_manage_macros.get('%sbuttons' % item_type)" />
      </ul>
    </form>
  </div> <!-- end .oc-widget-dataTable -->
</metal:pendinglist>



<!-- ACTIVE TEAM MEMBER LIST  -->

<metal:mshiplist define-macro="mshiplist">
  <div class="oc-widget oc-widget-dataTable"
       tal:define="mships view/active_mships;
                   num_items python:len(mships)">

    <div class="oc-heading">
      <h3 tal:content="string:Your team members ($num_items)" />
    </div>

    <div class="oc-searchresults-nresults">
      1-20 of 55
    </div>
    
    <form class="oc-liveForm" name="team-members" method="post"
          tal:attributes="action view/formsubmit">
      <table class="oc-dataTable" cellpadding="0" cellspacing="0">

        <thead>
          <tr>
            <th class="oc-dataTable-checkBoxColumn"><input type="checkbox" class="oc-checkAll" /></th>
            <th scope="col"><a class="oc-columnSortable oc-selected" href="">Username &darr;</a></th>
            <th scope="col"><a class="oc-columnSortable" href="">Role</a></th>
            <th scope="col"><a class="oc-columnSortable" href="">Effective since</a></th>
            <th scope="col"><a class="oc-columnSortable" href="">Listed</a></th>
          </tr>
        </thead>

	<tbody>

          <tal:items repeat="item mships">

            <tr class="oc-liveItem" tal:attributes="id item/id">

              <td>
                <input type="checkbox" name="member_ids:list"
                       tal:attributes="value item/id" />
              </td>

              <td>
                <div metal:use-macro="team_manage_macros/memberlink" />
              </td>

              <td>
                <div class="oc-liveItem-value"
                     tal:content="item/role">
                </div>
              </td>

              <td>
                <div class="oc-liveItem-value"
                     tal:define="active_since item/active_since"
                     tal:content="python:view.pretty_date(active_since)">
                </div>
              </td>

              <td>
                <div class="oc-liveItem-value"
                     tal:content="item/listed">
                </div>
              </td>

            </tr>

          </tal:items>

	</tbody>

      </table>

      <ul class="oc-actions oc-dataTable-actions">
        <li>
          <button type="submit" name="remove-members:boolean"
                  value="True" class="oc-button" >remove members</button>
        </li>
      </ul>
    </form>
  </div> <!-- end .oc-widget-dataTable -->
</metal:mshiplist>
