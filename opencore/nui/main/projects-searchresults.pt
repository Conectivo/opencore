<html i18n:domain="opencore" metal:use-macro="here/@@standard_macros/master">
  <head>
    <title metal:fill-slot="title"
           tal:content="string:Search ${view/project_noun/title}s - ${view/portal_title}" />
  </head>  
  <body> 

    <div metal:fill-slot="content">              
      
      <div id="oc-content-main">
        
        <tal:set_var define="current_search_page string:projects;
			     form_action_url string:${context/absolute_url}/searchresults">
          <div metal:use-macro="here/main_macros/search_widget" />
        </tal:set_var>
        
        <div class="oc-widget oc-widget-feed">

          <!-- batch needs to have some variables set up to work properly.
               here is where they are defined -->
          <tal:got_results condition="view/search_results"
                           define="batch view/search_results;
                                   batch_base_url request/ACTUAL_URL;
                                   start batch/start | nothing;
                                   end batch/end | nothing;
                                   sequence_length batch/sequence_length | nothing;
                                   ">

            <!-- display the number of results that came back -->
            <div class="oc-feed-sorter"
		 tal:define="many python: start!=end;
			     search_prefix string:project">
              <!-- pagination uses the batch macro -->
              <div metal:use-macro="here/@@nui_batch_macros/pagination"/>
	      
	      <div metal:use-macro="here/@@nui_batch_macros/sort_widget"/>

            </div>

            <!-- the results are displayed here -->
            <ol class="oc-feed-list">
              <li class="oc-feed-item oc-clearAfter" tal:repeat="item view/search_results">
                <a tal:define="proj_url python:view.project_url(item.getId)"
                   tal:attributes="href proj_url" >
                    <tal:setvar define="logo python:view.logo_for_proj_brain(item);
                                        logo_url python:logo and ('%s/logo_thumb' % proj_url) or view.defaultProjLogoURL">
                      <img class="oc-project-logo" tal:attributes="src logo_url; alt item/Title; title item/Title" />
                    </tal:setvar>
                  </a>
                <div class="oc-feed-item-content">

                  <h3 class="oc-feed-item-title"><a tal:attributes="href string:${context/portal_url}/projects/${item/getId}" tal:content="item/Title">Project Title</a> </h3> 

                  <span class="oc-feed-item-data oc-discreetText" tal:define="sorting_by request/sort_by | nothing">

                    <tal:not-modified-block condition="python: sorting_by != 'modified'">
                      created by
                      <a tal:define="userid item/Creator" tal:attributes="href string:${context/portal_url}/people/${userid}/profile" tal:content="userid" />,
                      <span tal:content="python: view.pretty_date(item.CreationDate)" />
                    </tal:not-modified-block>

                    <tal:modified-block tal:condition="python: sorting_by == 'modified'">
                      last updated
                      <tal:has_updated_author define="userid item/lastModifiedAuthor" condition="userid">
                        by
                        <a tal:attributes="href string:${context/portal_url}/people/${userid}/profile" tal:content="userid" />,
                      </tal:has_updated_author>
                      <span tal:content="python: view.pretty_date(item.ModificationDate)" />
                    </tal:modified-block>

                  </span>

                  <p class="oc-feed-item-description" tal:define="desc item/Description">
                    <span tal:condition="desc" tal:replace="desc" />
                  </p>

                </div>

              </li>
            </ol>
            <div class="oc-feed-sorter" tal:define="many python: start!=end">

              <!-- we put pagination on the bottom of the page too -->
              <div metal:use-macro="here/@@nui_batch_macros/pagination"/>

              <span tal:replace="view/project_noun/title">Project</span><tal:plural condition="many">s</tal:plural> <span tal:replace="start">1</span>
              <tal:justone condition="many">&ndash; <span tal:replace="end">10</span></tal:justone> 
              of <span tal:replace="sequence_length">376</span> </div>
          </tal:got_results>

          <!-- if we get no results, this is what is displayed -->
          <div i18n:translate="projects-searchresults_no_results" tal:condition="not: view/search_results">No results found.</div>

        </div> <!-- oc-searchresults -->
      </div> <!-- content-main -->
      
    </div><!-- content-fill-slot -->
  </body>
</html>
