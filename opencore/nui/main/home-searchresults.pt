<html i18n:domain="opencore" metal:use-macro="here/@@standard_macros/master">
  <head>
    <title metal:fill-slot="title"
           tal:content="string:Search - ${view/portal_title}" />
  </head>
  <body>
    <div metal:fill-slot="content">
      <div id="oc-content-main" tal:define="batch view/batched_results">
        
        <tal:set_var define="current_search_page string:sitesearch;
			     form_action_url string:${context/absolute_url}/sitesearch">
          <div metal:use-macro="here/main_macros/search_widget" />
        </tal:set_var>
        
        <div class="oc-lineup">

          <!-- batch needs to have some variables set up to work properly.
               here is where they are defined -->
          <tal:got_results condition="batch">

            <!-- display the number of results that came back -->
            <div class="oc-lineup-sorter"
		 tal:define="many python: batch.start!=batch.end;">
              
              <!-- pagination uses the batch macro -->
              <div metal:use-macro="here/@@nui_batch_macros/pagination"/>
              
	      <div metal:use-macro="here/@@nui_batch_macros/sort_widget"/>

            </div>


            <!-- the results are displayed here -->
            <ol class="oc-lineup-list">
              <li class="oc-lineup-item" tal:repeat="item batch">
		<tal:defines define="obj item/getObject; portal_type obj/portal_type; is_user python: portal_type == 'OpenMember'">
                  
                  <tal:comment replace="nothing">
                    XXX This can be factored out somehow to deal with the differences
                  </tal:comment>
                    <tal:is_user condition="is_user">
                      <h3><img tal:attributes="src obj/getIcon" /> <a href="" tal:attributes="href string:${context/portal_url}/people/${item/getId}/profile" tal:content="item/Title">Title</a></h3>
                      <span class="oc-discreetText">
                      member since
                      <span tal:replace="python: view.pretty_date(item.CreationDate)" />
                      </span>
                    </tal:is_user>
                    <tal:not_user condition="not: is_user">
                      <h3><img tal:attributes="src obj/getIcon" /> <a href="" tal:attributes="href obj/absolute_url" tal:content="item/Title">Title</a></h3>
                      <span class="oc-discreetText">
                      <tal:is_page condition="python: portal_type == 'Document'">
                        <tal:project_define define="proj python: obj.aq_parent">
                          in
                          <a tal:attributes="href proj/absolute_url" tal:content="proj/Title" />,
                        </tal:project_define>
                      </tal:is_page>
                      <tal:has_updated_author define="userid item/lastModifiedAuthor" condition="userid">
                        modified by
                        <a tal:attributes="href string:${context/portal_url}/people/${userid}/profile" 
                           tal:define="mem_title nocall:context/@@oc-utils/member_title"
                           tal:content="python:mem_title(userid)" />,
                      </tal:has_updated_author>
		      last updated		      
		      <span tal:replace="python: view.pretty_date(item.ModificationDate)" />
		      </span>
                    </tal:not_user>
                  </tal:defines>
              </li>
            </ol>
            <div class="oc-lineup-sorter" tal:define="many python: batch.start!=batch.end">
              
              <!-- we put pagination on the bottom of the page too -->
              <div metal:use-macro="here/@@nui_batch_macros/pagination"/>
              
            <div tal:replace="structure python: view.sort_widget_string(batch.start, batch.end, batch.sequence_length)" />

	    </div>
          </tal:got_results>

          <!-- if we get no results, this is what is displayed -->
          <div i18n:translate="home-searchresults_no_results" tal:condition="not:batch">No results found.</div>

	</div> <!-- oc-lineup -->
      </div> <!-- content-main -->

    </div><!-- content-fill-slot -->
  </body>
</html>
