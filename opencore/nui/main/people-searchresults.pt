<html i18n:domain="opencore" metal:use-macro="here/@@standard_macros/master">
  <head>
    <title metal:fill-slot="title"
           tal:content="string:Search People - ${view/portal_title}" />
  </head>
  <body>

    <div metal:fill-slot="content">              

      <div id="oc-content-main">
        
        <tal:set_var define="current_search_page string:people;
                             form_action_url string:${context/absolute_url}/searchresults">
          <div metal:use-macro="here/main_macros/search_widget" />
        </tal:set_var>
        
        <div class="oc-directory">

          <!-- batch needs to have some variables set up to work properly.
               here is where they are defined -->
          <tal:got_results condition="view/search_results"
                           define="batch view/search_results;
                                   batch_base_url request/ACTUAL_URL;
                                   start batch/start | nothing;
                                   end batch/end | nothing;
                                   sequence_length batch/sequence_length | nothing;
                                   ">

            <!-- display the number of results that came back -->
            <div class="oc-directory-sorter" tal:define="many python: start!=end">              
              <!-- pagination uses the batch macro -->
              <div metal:use-macro="here/@@nui_batch_macros/pagination"/>
              
              Member<tal:plural condition="many">s</tal:plural> <span tal:replace="start">1</span>
              <tal:justone condition="many">&ndash; <span tal:replace="end">10</span></tal:justone> 
              of <span tal:replace="sequence_length">376</span> sorted 

              <form name="people_sort" tal:attributes="action string:${context/absolute_url}/searchresults">
                <!-- FIXME This should not require a button to work. -->
                <select class="oc-js-autoSelect" name="sort_by" tal:define="sorted_by python: request.get('sort_by')">
                  <option tal:condition="not: request/letter_search | nothing" value="relevancy" tal:attributes="selected python: sorted_by == 'relevancy'">by relevancy</option>
                  <option value="getId" tal:attributes="selected python: sorted_by == 'getId'">by username</option>
                  <option value="exact_getFullname" tal:attributes="selected python: sorted_by == 'exact_getFullname'">by name</option>
                </select>



                <!-- resend the current data when sorting -->
                <input tal:condition="request/search_for | nothing" type="hidden" name="search_for"
                       tal:attributes="value request/search_for" />

                <input tal:condition="request/letter_search | nothing" type="hidden" name="letter_search"
                       tal:attributes="value request/letter_search" />

		<input tal:condition="request/batch_size | nothing" type="hidden" name="batch_size"
		       tal:attributes="value request/batch_size" />

                <input type="submit" name="action_sort_people" value="sort" />

              </form>
            </div>

            <!-- the results are displayed here -->
            <ol class="oc-directory-list oc-clearAfter"
                tal:define="ms_tool nocall:context/portal_membership">
              <li class="oc-clearAfter vcard" tal:repeat="item view/search_results">
               <span tal:omit-tag=""
                     tal:define="mem item/getObject;
	                         memdata python:view.member_info_for_member(mem);
                                 mt nocall:context/@@oc-utils/member_title;
                                 mem_title  python:mt(memdata);
                                 home_url python:ms_tool.getHomeUrl(memdata['id'])">
                <div class="oc-avatar">
                  <a tal:attributes="href home_url">
                    <img class="photo" 
                      tal:define="portraittxt string:${mem_title} portrait"
                      tal:attributes="src memdata/portrait_thumb_url" />
                  </a>
                </div>
                <div class="oc-directory-content">
                  <h3 class="fn nickname">
                    <a href="" tal:attributes="href home_url"
                       tal:content="mem_title">Username</a>
                  </h3>
                  <div class="oc-discreetText adr" tal:define="loc item/getLocation" tal:condition="loc"><span class="locality" tal:content="loc" /></div>
                </div>
               </span>
              </li>
            </ol>
            <div class="oc-directory-sorter" tal:define="many python: start!=end">
              
              <!-- we put pagination on the bottom of the page too -->
              <div metal:use-macro="here/@@nui_batch_macros/pagination"/>
              
              Member<tal:plural condition="many">s</tal:plural> <span tal:replace="start">1</span>
              <tal:justone condition="many">&ndash; <span tal:replace="end">10</span></tal:justone> 
              of <span tal:replace="sequence_length">376</span> 
            </div>
          </tal:got_results>

          <!-- if we get no results, this is what is displayed -->
          <div i18n:translate="people-searchresults_no_results" tal:condition="not: view/search_results">No results found.</div>

        </div> <!-- oc-searchresults -->
      </div> <!-- content-main -->

    </div><!-- content-fill-slot -->
  </body>
</html>
