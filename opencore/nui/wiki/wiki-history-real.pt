<html metal:use-macro="here/@@standard_macros/master">
  <head>
    <script metal:fill-slot="script" src="++resource++javascripts/checkbox-limit-select.js"></script>
  </head>
  <body>
    <div metal:fill-slot="content"
         tal:define="pr nocall:here/portal_repository;">
      
      <div id="oc-content-main" class="oc-content-main-fullWidth">
	
	<!-- FIXME this should not be repeated everywhere --> 
	<div class="oc-wiki">
	  
	  <tal:block 
             tal:define="version_id python:request.get('version_id', None);
			 history view/get_versions;
			 people_url python:here.portal_membership.getMembersFolder().absolute_url();"
             tal:condition="python: pr.isVersionable(context)">
	    
	    <div class="oc-headingBlock oc-wiki-headingBlock">
              <h2 tal:content="view/pagetitle"></h2>
            </div>
            <ul class="oc-tabs">
              <li class="">
		<a href="@@index.html" rel="view">view</a>
              </li>
              <li>
		<a href="" rel="edit">edit</a>
              </li>
              <li>
		<a href="" class="oc-selected" rel="history">history</a>
              </li>
              <!--<li tal:condition="nothing">-->
              <li>
		<form class="" >
                  <select class="oc-dropdown-links">
                    <option value="">More...</option>
                    <option value="http://www.google.com">I'm feeling lucky</option>
                  </select>
                  <input type="submit" value="Go" style=""/>
		</form>
              </li>
            </ul><!-- end .oc-tabs -->
	    <!-- FIXME --> 
	    asd;flkjsdf;ldsk
	    
	    <tal:if condition="python:len(history) > 0"> 
              <div class="oc-headingBlock"
		   tal:define="lastChange python:history[0]"> 
		<h2>All versions of <span tal:replace="here/title_or_id">page</span></h2>
		<p class="oc-headingContext oc-discreetText">
		  Last edit performed by 
		  <a tal:define="author lastChange/sys_metadata/principal" 
                     tal:attributes="href string:${people_url}/${author}" 
                     tal:content="author">author</a>, 
		  
		  <span tal:replace="python: view.pretty_mod_date(lastChange)" /> 
		  <br />
		  <span tal:replace="python:len(history)"/> versions total.
		</p>
              </div> <!-- end .oc-headingBlock --> 
	      <hr />
	      
              <!-- FIXME: this language makes it seem like you can check a single
                   version to see a preview of that version, but you actually have
                   to click the link/name of the version -->
              <p>Select 2 versions to compare them OR click a version number to see it.</p>
	      
              <div class="oc-lineup"> 		
		<!-- FIXME: we should give a javascript error when you try to submit without two
                     checkboxes selected -->
		<form action="version_compare" id="version_compare_form" method="get">
                  
		  <div class="oc-actions">
                    <input type="submit" value="Compare" />
		  </div> <!-- end .oc-actions --> 
		  <div class="oc-message">
		  
		  </div>
		  
        <ul class="oc-lineup-list">
          <tal:block repeat="version python: history">
		      <li class="oc-wiki-history-item oc-lineup-item"
			  tal:define="version_id version/version_id;
                                      version_title python:view.version_title(version_id)">
			     <input type="checkbox" name="version_id"
                               tal:attributes="value version_id;
                                               id string:version-${version_id};
                                               title version_title" 
			       limit-select="2"/>
			<!-- do not make this a label! it will make the checkbox
			     check when you follow the link. use a title on the 
			     checkbox instead. --> 
			<h3>
                          <!-- FIXME should this be absolute ?? --> 
                          <a tal:attributes="href string:version?version_id=${version_id}"><tal:span replace="version_title" /></a>
			</h3>
			by 
			<a tal:define="author version/sys_metadata/principal" 
                           tal:attributes="href string:${people_url}/${author}" 
                           tal:content="author">author</a>, 
			<span tal:replace="python: view.pretty_mod_date(version)" />
			<p class="oc-wiki-history-item-context oc-discreetText">
			  <span tal:replace="version/comment">comment</span>
			</p>
                      </li> 
		    </tal:block> <!-- end repeat version history --> 
		  </ul>   		  
		  <div class="oc-actions">
		    <input type="submit" value="compare" />
		  </div> <!-- end .oc-actions --> 
		</form> <!-- end #version_compare_form --> 
              </div> <!-- end #oc-lineup div -->
            </tal:if>
            <tal:if condition="python: len(history) == 0">
              There are no previous versions of this page
            </tal:if>
	  </tal:block><!-- end of content for versionable objects -->       
	  <tal:block tal:condition="python: not pr.isVersionable(context)">
            <div id="oc-content-main"> 
              This content does not have versioning information.
            </div>
	  </tal:block> 

	</div> <!-- end .oc-wiki -->
      </div> <!-- end #oc-content-main -->
    </div><!-- end fill-slot=content -->
  </body>
</html>
